<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: LogStream.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: LogStream.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

var Readable = require('stream').Readable

/**
 * A live stream of matching logs being written to the server.
 * You are not expected to create instances of this class,
 * instead they are handed to you by the {@link Connection#stream} callback.
 * 
 * This is a ReadableStream in object mode.
 * See {@link Connection~Log} for the received object format.
 * @class
 * @extends Readable
 * @param {Connection} connection
 * @param {string} id
 */
function LogStream(connection, id) {
	Readable.call(this, {
		objectMode: true
	})

	/**
	 * Parent connection
	 * @member {Connection}
	 * @readonly
	 */
	this.connection = connection

	/**
	 * Whether this stream has been shut down
	 * @member {boolean}
	 * @readonly
	 */
	this.stopped = false

	/**
	 * @member {string}
	 * @private
	 */
	this._id = id
	
	/**
	 * @member {Function}
	 * @private
	 */
	this._bindedOnlog = this._onlog.bind(this)

	connection._peer.on('stream', this._bindedOnlog)
	connection.once('close', this._stop.bind(this))
}

require('util').inherits(LogStream, Readable)
module.exports = LogStream

/**
 * Shutdown this stream
 */
LogStream.prototype.stop = function () {
	var that = this
	if (!this.stopped) {
		this._stop()
		this.connection._execute('unsetStream', this._id, function (err) {
			if (err) {
				that.emit('error', err)
			}
		})
	}
}

/**
 * @private
 */
LogStream.prototype._read = function () {
	// Data is pushed outside of read
}

/**
 * @param {Object} data
 * @private
 */
LogStream.prototype._onlog = function (data) {
	if (!this.stopped &amp;&amp; data.id === this._id) {
		this.push(data.log)
	}
}

/**
 * @private
 */
LogStream.prototype._stop = function () {
	if (!this.stopped) {
		this.stopped = true
		this.push(null)
		this.connection._peer.removeListener('stream', this._bindedOnlog)
	}
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Connection.html">Connection</a></li><li><a href="Logger.html">Logger</a></li><li><a href="LogStream.html">LogStream</a></li></ul><h3>Events</h3><ul><li><a href="Connection.html#event:close">close</a></li><li><a href="Connection.html#event:connect">connect</a></li><li><a href="Connection.html#event:connecting">connecting</a></li><li><a href="Connection.html#event:error">error</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha13</a> on Sun Jan 18 2015 00:21:54 GMT-0200 (Horário brasileiro de verão)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
