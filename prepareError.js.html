<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: prepareError.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: prepareError.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

var basePath = require('path').resolve('.')

/**
 * Prepare error instance for logging
 * @param {?Error} error
 * @returns {Object}
 */
module.exports = function prepareError(error) {
	if (error === null || error === undefined) {
		return null
	} else if (typeof error !== 'object') {
		throw new Error('Invalid error, expected an object, got a ' + typeof error)
	}

	var obj = {
		stack: []
	}

	Object.getOwnPropertyNames(error).forEach(function (key) {
		var value = error[key]

		if (key === 'domain' ||
			key === 'domainEmitter' ||
			key === 'domainBound' ||
			key === 'domainThrown') {
			// Ignore properties set by domain, because
			// they're too noisy (complex objects) and 
			// give no useful information in practice
			return
		}

		if (key === 'stack') {
			// Parse stack
			obj.stack = prepareStack(String(value))
			return
		}

		var foundObjects = [],
			paths = []
		obj[key] = copyDeep(value, key)

		// Make a deep copy, but avoid multiple/circular references
		function copyDeep(value, path) {
			if (value &amp;&amp; typeof value === 'object') {
				var pos = foundObjects.indexOf(value)
				if (pos !== -1) {
					return '[Reference ' + paths[pos] + ']'
				}
				foundObjects.push(value)
				paths.push(path)

				if (Array.isArray(value)) {
					return value.map(function (value, key) {
						return copyDeep(value, path + '.' + key)
					})
				} else if (value instanceof Error) {
					return prepareError(value)
				}

				return Object.keys(value).reduce(function (obj, key) {
					obj[key] = copyDeep(value[key], path + '.' + key)
					return obj
				}, {})
			}
			return value
		}
	})

	return obj
}

/**
 * Split each stack frame and normalize paths
 * @param {string} stack
 * @returns {Array&lt;string>}
 * @private
 */
function prepareStack(stack) {
	var lines = stack.split('\n').slice(1)
	return lines.map(function (line) {
		return line.trim().replace(/^at /, '').replace(basePath, '.')
	})
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Connection.html">Connection</a></li><li><a href="Logger.html">Logger</a></li><li><a href="LogStream.html">LogStream</a></li></ul><h3>Events</h3><ul><li><a href="Connection.html#event:close">close</a></li><li><a href="Connection.html#event:connect">connect</a></li><li><a href="Connection.html#event:connecting">connecting</a></li><li><a href="Connection.html#event:error">error</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Sun Aug 30 2015 00:25:47 GMT-0300 (Hora oficial do Brasil)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
